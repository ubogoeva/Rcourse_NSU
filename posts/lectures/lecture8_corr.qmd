---
title: "Корреляция и линейная регрессия"
author: "Елена Убогоева"
date: '04 Feb 2023'
execute: 
  echo: true
format: 
  revealjs:
    slide-number: c/t
    # mainfont: Arial
    # fontsize: 14px
    theme: [default, custom.scss]
    # theme: [serif]
    # mouse-wheel: true
    auto-play-media: true
    width: 1280
    height: 720
draft: true
editor: visual
---

## План лекции

-   Что такое ковариация и корреляция

-   Линейная регрессия

## Линейная регрессия

Вообще линейная регрессия является частью общей линейной модели, куда входит также дисперсионный анализ (ANOVA).

Общий принцип GLM заключается в том, что у нас есть зависимая переменная (dependent variable), которую мы пытаемся описать (предсказать) одной или несколькими независимыми переменными.

В случае линейной регрессии зависимая переменная должна быть непрерывной, в то время как независимые могут быть как непрерывными, так и категориальными.

Предсказать - значит найти такую функцию вида `y = f(x)`

## Примеры функций

-   $y = x$: `y` в точности равно `x`

-   $y = ax$: `y` равно `x` умноженное на константу `a`. `a` в этом уравнении часто называют наклон (slope)

-   $y = ax + b$: `y` равно `x` умноженное на константу `a` плюс значение константы `b`

-   $y = x^2$ квадратичная зависимость

## Нотация уравнений в статистике

Обычно используется уравнение вида:

$y = \beta_0 + \beta_1x_1 + e$, где $\beta_0$ это *интерсепт* или перехват (intersept), $\beta_1$ чаще называют *коэффициентом* (а не наклоном), а $e$ это *остаток* (residual или error term) - поскольку мы работаем с реальными данными, то почти никогда зависимая переменная `y` не будет предсказываться в точности независимыми

## Пример разбора линейной регрессии

::: columns
::: {.column width="50%"}
Создадим игрушечный датасет по предсказанию цены автомобиля в зависимости от возраста. Цены указаны в тысячах евро.

```{r}
#| echo: false
library(ggplot2)
df <- data.frame(Price = c(29, 25, 21, 18, 15, 15), 
                 Age = c(1, 2, 2, 3, 4, 5))
df
```
:::

::: {.column width="50%"}
Построим *диаграмму рассеяния* (scatterplot), чтобы отразить зависимость цены от возраста

```{r}
#| echo: false
ggplot(df, aes(Age, Price))+
  geom_point(size = 9, color = 'red3')+
  theme_classic()+
  scale_y_continuous(name = 'Price, k€', limits = c(10, 30),
                     breaks = seq(10, 30, 5))+
  scale_x_continuous(limits = c(1,6), breaks = 1:6)+
  theme(axis.text.x = element_text(size = 20),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 24),
        axis.title.y = element_text(size = 24))
```
:::
:::

Теперь попробуем провести прямую линию, которая будет наиболее хорошо описывать точки

## Пример разбора линейной регрессии

```{r}
#| echo: false
ggplot(df, aes(Age, Price))+
  geom_point(size = 9, color = 'red3')+
  geom_smooth(formula = y~ x, method = lm, se = FALSE)+
  theme_classic()+
  scale_y_continuous(name = 'Price, k€', limits = c(10, 30),
                     breaks = seq(10, 30, 5))+
  scale_x_continuous(limits = c(1,6), breaks = 1:6)+
  theme(axis.text.x = element_text(size = 20),
        axis.text.y = element_text(size = 20),
        axis.title.x = element_text(size = 24),
        axis.title.y = element_text(size = 24))
```

## Допущения линейной регрессии

-   **Ограничения данных:** предсказываемая переменная должна быть непрерывной, интервальной или ранговой, в теории неограниченной. Независимые переменные могут быть как непрерывными, так и категориальными.

-   **Независимость:** каждое наблюдение должно быть независимым от остальных

-   **Линейность:** зависимость между зависимой переменной и независимой должна быть линейной

-   **Гомоскедастичность** (homoscedasticity) - однородность дисперсий

-   Независимость и нормальное распределение остатков (ошибок, residuals)

-   **Проверка на мультиколлинеарность** - в случае множественной линейной регрессии

## Проверка допущений

Нужно отрисовать сам график и QQ-plot

scatter plot:

![](https://www.tibco.com/sites/tibco/files/media_entity/2022-01/scatter-chart-example.svg)

------------------------------------------------------------------------

\
Например такой график говорит о почти полном соблюдении допущения гомоскедастичности:

![](https://upload.wikimedia.org/wikipedia/commons/thumb/0/08/Normal_normal_qq.svg/450px-Normal_normal_qq.svg.png){width="431"}

## Мультиколлинеарность

Если в множественной линейной регрессии много скоррелированных друг с другом переменных, то это может сильно испортить значения коэффициентов, p-value и доверительные интервалы. Чтобы проверить на скоррелированность нужно посчитать VIF (variance inflation factor)

![](https://wikimedia.org/api/rest_v1/media/math/render/svg/9ece9d349f82af412b94fcdd2e81c1c6de926936)
